<html>
    <head>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
    <script>
    	var socket = io('http://127.0.0.1:8991');
	var initialised = false;
	var name = null;
	const baud = 9600;
	var data = "";
    	socket.on('message', function(event) {
		if (event.startsWith("list") || event.startsWith("open")) return;
		var json = JSON.parse(event);
		if (!initialised) {
			socket.emit('command', 'list');
			initialised = true;
		}
		else if (json.Ports) {
			console.log(event);
			if (!json.Network) {
				name = json.Ports[0].Name;
				console.log(`open ${name} ${baud}`);
				socket.emit('command', `open ${name} ${baud}`);
			}
		}
		else if (json.D) {
			data += json.D ;
			if (json.D=='\n') {
				console.log(data);
				data = "";
			}
		}
		else console.log(event);
	});
    </script>
    </head>
    <body>
    <h1>Arduino Agent</h1>
    </body>
</html>
