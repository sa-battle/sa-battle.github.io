<html>
    <head>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
    <script>
    	var socket = io('http://127.0.0.1:8991');
	var initialised = false;
	var name = null;
	var baud = null;
	var data = "";
	var cmd;
	var json = null;

    	socket.on('message', function(event) {
		try { json = JSON.parse(event); }
		catch (e) {
			console.log(event);
			return;
		}
		/*if (!initialised) {
			console.log(cmd='list');
			socket.emit('command', cmd);
			initialised = true;
		}
		else */
		if (json.Ports) {
			console.log(event);
			if (!json.Network) {
				name = json.Ports[0].Name;
				baud = json.Ports[0].Baud;
				console.log(cmd=`open ${name} ${baud}`);
				socket.emit('command', cmd);
			}
		}
		else if (json.D) {
			data += json.D ;
			if (json.D=='\n') {
				console.log(data);
				data = "";
			}
		}
		else console.log(event);
	});
	console.log(cmd='list');
	socket.emit('command', cmd);
    </script>
    </head>
    <body>
    <h1>Arduino Agent</h1>
    </body>
</html>
